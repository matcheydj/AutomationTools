<?xml version="1.0"?>
<Vulnerability xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Lang="DEU" Vul_ID="FileVaultActivation-10" Revision="64">
  <Status>Enabled</Status>
  <Groups />
  <DependsOn />
  <Patches>
    <Patch UniqueFilename="*FileVaultActivation-10_detect and remediate disabled FileVault" Hash="" Sha1="" Silent="CRSNo" Reboot="RNo" Download="DManual" Size="0">
      <Name>detect and remediate disabled FileVault</Name>
      <Advanced>
        <DetectScript>#!/bin/bash
/usr/bin/fdesetup isactive

if [ $?  -ne 0 ]; then
  echo "Found: Unencrypted drive"
  echo "Reason: FileVault not active"
  echo "Expected: FileVault active"
  echo "Detected:1"
else
  echo "Detected:0"
fi
</DetectScript>
      </Advanced>
      <Comments />
      <URL />
      <State>Enabled</State>
      <Files />
      <AdditionalFiles />
      <RegKeys />
      <Products />
      <Platforms>
        <ID>macosx</ID>
        <ID>macosxserver</ID>
      </Platforms>
      <Processes />
      <UninstallInfo>
        <canBeUninstalled>false</canBeUninstalled>
        <requiresOriginalPatch>false</requiresOriginalPatch>
        <Files />
        <RegKeys />
        <Cmds />
      </UninstallInfo>
      <CustVars />
      <Cmds>
        <Cmd Type="ShellScript">
          <Args>
            <Arg N="ScriptCode" V="#!/bin/bash &#xD;&#xA;echo `/bin/date` &quot;enabling FileVault with defer option&quot;&#xD;&#xA;&#xD;&#xA;recoveryHD=&quot;NO&quot;&#xD;&#xA;&#xD;&#xA;coreStorage=&quot;NO&quot; &#xD;&#xA;atLeastYosemite=&quot;NO&quot;&#xD;&#xA;atLeast10103=&quot;NO&quot; &#xD;&#xA;systemMajorVersion=`sw_vers | grep &quot;ProductVersion:&quot; | cut -d ':' -f 2 | cut -d '.' -f 2` &#xD;&#xA;systemMinorVersion=`sw_vers | grep &quot;ProductVersion:&quot; | cut -d ':' -f 2 | cut -d '.' -f 3`&#xD;&#xA;if [ $systemMajorVersion -eq 10 ]; then &#xD;&#xA;atLeastYosemite=&quot;YES&quot;&#xD;&#xA;if [ $systemMinorVersion -ge 3 ]; then&#xD;&#xA;atLeast10103=&quot;YES&quot; &#xD;&#xA;fi &#xD;&#xA;elif [ $systemMajorVersion -gt 10 ]; then &#xD;&#xA;atLeastYosemite=&quot;YES&quot;&#xD;&#xA;atLeast10103=&quot;YES&quot; &#xD;&#xA;fi&#xD;&#xA;deferFile=`diskutil info / | grep &quot;Volume Name:&quot; | cut -d ':' -f 2 | sed -e 's/^ *//' -e 's/ *$//'`&#xD;&#xA;diskutil cs info /&#xD;&#xA;if [ $?  -eq 0 ]; then&#xD;&#xA;coreStorage=&quot;YES&quot; &#xD;&#xA;echo &quot;CoreStorage&quot; &#xD;&#xA;fi&#xD;&#xA;diskutil list | grep &quot;Recovery HD&quot;&#xD;&#xA;if [ $?  -eq 0 ]; then&#xD;&#xA;recoveryHD=&quot;YES&quot; &#xD;&#xA;echo &quot;Recovery HD&quot; &#xD;&#xA;fi &#xD;&#xA;echo &quot;CoreStorage = &quot; $coreStorage &#xD;&#xA;echo &quot;Recovery HD = &quot; $recoveryHD&#xD;&#xA;if [ &quot;$coreStorage&quot; == &quot;NO&quot; ]; then&#xD;&#xA;if [ &quot;$recoveryHD&quot; == &quot;NO&quot; ]; then &#xD;&#xA;echo `/bin/date` &quot;Boot Volume is not a CoreStorage Volume, and there is no Recovery HD, so FileVault cannot be enabled.&quot; &#xD;&#xA;/Library/Application\ Support/LANDesk/bin/ldnotify -m &quot;LANDESK LDMS kann nicht FileVault für das Volumen $deferFile auf diesem Gerät aktivieren, da $deferFile nicht ein Core-Storage-Volumen ist und keine  Recovery HD vorhanden ist.&quot; -y &quot;OK&quot; -p &quot;FileVault wurde noch nicht aktiviert&quot; &#xD;&#xA;&#xD;&#xA;exit 1 &#xD;&#xA;fi &#xD;&#xA;fi&#xD;&#xA;deferFile=`diskutil info / | grep &quot;Volume Name:&quot; | cut -d ':' -f 2 | sed -e 's/^ *//' -e 's/ *$//'`&#xD;&#xA;if [ &quot;$atLeast10103&quot; == &quot;YES&quot; ]; then&#xD;&#xA;sudo fdesetup enable -defer &quot;/Library/Application Support/LANDesk/data/$deferFile-fv2recovery.plist&quot;  -dontaskatlogout -forceatlogin 0 &#xD;&#xA;else&#xD;&#xA;&#xD;&#xA;sudo fdesetup enable -defer &quot;/Library/Application Support/LANDesk/data/$deferFile-fv2recovery.plist&quot; &#xD;&#xA;fi&#xD;&#xA;if [ $?  -ne 0 ]; then &#xD;&#xA;echo `/bin/date` &quot;fdesetup enable -defer failed&quot; &#xD;&#xA;exit 1 &#xD;&#xA;else&#xD;&#xA; &#xD;&#xA;echo `/bin/date` &quot;setting up submit to core of the FileVauilt2RecoveryKey&quot;&#xD;&#xA;sudo /Library/Application\ Support/LANDesk/bin/ldsubmitclientdata -dataname=&quot;FileVauilt2RecoveryKey&quot; -d -retry=20 -datafile=&quot;/Library/Application Support/LANDesk/data/$deferFile-fv2recovery.plist&quot; &#xD;&#xA;/Library/Application\ Support/LANDesk/bin/ldnotify -m &quot;LANDESK LDMS hat FileVault für das Volumen $deferFile auf diesem Gerät aktiviert.  Bitte führen Sie so schnell wie möglich einen Neustart auf dem Geräts aus, damit der Vorgang abgeschlossen werden kann.&quot; -y &quot;OK&quot; -p &quot;FileVault wurde aktiviert&quot; &#xD;&#xA;exit 0 &#xD;&#xA;fi " />
          </Args>
        </Cmd>
      </Cmds>
    </Patch>
  </Patches>
  <AssociatedProducts />
  <IAVAs />
  <PublishDate>2015-08-25T00:00:00.0000000</PublishDate>
  <Title>FileVault Activation version 1.1</Title>
  <Description>Grundlegende Erkennung und Reparatur von Inhalten zur Verwaltung von FileVault auf Mac OS X Client-Geräten mit installiertem LDMS-Agent.

Die für dieses Verfahren benötigte Gerätesteuerung erfolgt über das Befehlszeilen-Tool fdesetup. Informationen zu fdesetup und dessen Optionen finden Sie auf der Hauptseite. Weitere Informationen zu dessen Verwendung finden Sie im Internet. Ein guter Einstige für weitere Informationen ist der hervorragende Blog zu MAC-Management von Rich Trouton: derflounder. Hier können Sie eine Einführung finden: &lt;https://derflounder.wordpress.com/2015/02/02/managing-yosemites-filevault-2-with-fdesetup/&gt;

Erkennung:

Der Status von FileVault auf dem Gerät wird mithilfe eines Hash-Skripts ermittelt.

Reparatur:

Mit einem Hash-Skript wird FileVault aktiviert und ein LDMS-Tools - ldsubmitclientdata - ausgeführt, um den Wiederherstellungsschlüssel sicher an den LANDESK-Server zu senden, auf dem er in einer sicheren Tabelle gespeichert wird.  Da die Tabelle vom Inventar unabhängig ist, werden die Datensätze nicht entfernt, wenn ein Gerät aus dem Inventar entfernt wird.
'fdesetup enable -defer' wird aufgerufen, wodurch (mit den in diesem Zusammenhang ausgewählten Optionen) der Benutzer gezwungen wird, den Vorgang bei der nächsten Anmeldung abzuschließen.  Mit der Verzögerungsoption 'defer' läuft fdesetup solange ausfallfrei, bis der Benutzer versucht, den Vorgang zu beenden. Das Skript versucht also, intelligent zu sein und die häufigsten Ausfallmodi im Voraus zu erkennen.

Damit FileVault auf einem Gerät aktiviert werden kann, muss eine der folgenden Bedingungen zutreffen: Das Startlaufwerk ist ein CoreStorage-Laufwerk, oder es muss ein Wiederherstellungslaufwerk vorhanden sein.  Das Skript stellt sicher, dass mindestens eine Bedingung erfüllt ist, Die Ausführung schlägt fehl, wenn beide Bedingungen nicht erfüllt sind.

Mit dem LANDESK-Tool ldnotify werden Benutzerinformationen bereitgestellt.

Die ldsubmitclientdata-Parameter sind: Datenname (für diie Coredatenbank, die nicht geändert werden sollte), Datendatei, d. h. der vollständige Pfad zur Datei mit dem Wiederherstellungsschlüssel (muss mit dem Defer-Parameter für fdesetup übereinstimmen) und Wiederholversuche, d. h. wie oft ldsubmitclientdata versucht, den Wiederherstellungsschlüssel an den Coreserver zu senden. Die Datei mit dem Wiederherstellungsschlüssel wird erst dann vom verwalteten Gerät gelöscht, wenn er erfolgreich an den Core gesendet wurde.</Description>
  <Severity>5</Severity>
  <Vendor>Ivanti</Vendor>
  <MoreInfoURL />
  <FAQURL />
  <Type>Configuration</Type>
</Vulnerability>
