<?xml version="1.0"?>
<Vulnerability xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Lang="JPN" Vul_ID="FileVaultActivation-10" Revision="64">
  <Status>Enabled</Status>
  <Groups />
  <DependsOn />
  <Patches>
    <Patch UniqueFilename="*FileVaultActivation-10_detect and remediate disabled FileVault" Hash="" Sha1="" Silent="CRSNo" Reboot="RNo" Download="DManual" Size="0">
      <Name>detect and remediate disabled FileVault</Name>
      <Advanced>
        <DetectScript>#!/bin/bash
/usr/bin/fdesetup isactive

if [ $?  -ne 0 ]; then
  echo "Found: Unencrypted drive"
  echo "Reason: FileVault not active"
  echo "Expected: FileVault active"
  echo "Detected:1"
else
  echo "Detected:0"
fi
</DetectScript>
      </Advanced>
      <Comments />
      <URL />
      <State>Enabled</State>
      <Files />
      <AdditionalFiles />
      <RegKeys />
      <Products />
      <Platforms>
        <ID>macosx</ID>
        <ID>macosxserver</ID>
      </Platforms>
      <Processes />
      <UninstallInfo>
        <canBeUninstalled>false</canBeUninstalled>
        <requiresOriginalPatch>false</requiresOriginalPatch>
        <Files />
        <RegKeys />
        <Cmds />
      </UninstallInfo>
      <CustVars />
      <Cmds>
        <Cmd Type="ShellScript">
          <Args>
            <Arg N="ScriptCode" V="#!/bin/bash &#xD;&#xA;echo `/bin/date` &quot;enabling FileVault with defer option&quot;&#xD;&#xA;&#xD;&#xA;recoveryHD=&quot;NO&quot;&#xD;&#xA;&#xD;&#xA;coreStorage=&quot;NO&quot; &#xD;&#xA;atLeastYosemite=&quot;NO&quot;&#xD;&#xA;atLeast10103=&quot;NO&quot; &#xD;&#xA;systemMajorVersion=`sw_vers | grep &quot;ProductVersion:&quot; | cut -d ':' -f 2 | cut -d '.' -f 2` &#xD;&#xA;systemMinorVersion=`sw_vers | grep &quot;ProductVersion:&quot; | cut -d ':' -f 2 | cut -d '.' -f 3`&#xD;&#xA;if [ $systemMajorVersion -eq 10 ]; then &#xD;&#xA;atLeastYosemite=&quot;YES&quot;&#xD;&#xA;if [ $systemMinorVersion -ge 3 ]; then&#xD;&#xA;atLeast10103=&quot;YES&quot; &#xD;&#xA;fi &#xD;&#xA;elif [ $systemMajorVersion -gt 10 ]; then &#xD;&#xA;atLeastYosemite=&quot;YES&quot;&#xD;&#xA;atLeast10103=&quot;YES&quot; &#xD;&#xA;fi&#xD;&#xA;deferFile=`diskutil info / | grep &quot;Volume Name:&quot; | cut -d ':' -f 2 | sed -e 's/^ *//' -e 's/ *$//'`&#xD;&#xA;diskutil cs info /&#xD;&#xA;if [ $?  -eq 0 ]; then&#xD;&#xA;coreStorage=&quot;YES&quot; &#xD;&#xA;echo &quot;CoreStorage&quot; &#xD;&#xA;fi&#xD;&#xA;diskutil list | grep &quot;Recovery HD&quot;&#xD;&#xA;if [ $?  -eq 0 ]; then&#xD;&#xA;recoveryHD=&quot;YES&quot; &#xD;&#xA;echo &quot;Recovery HD&quot; &#xD;&#xA;fi &#xD;&#xA;echo &quot;CoreStorage = &quot; $coreStorage &#xD;&#xA;echo &quot;Recovery HD = &quot; $recoveryHD&#xD;&#xA;if [ &quot;$coreStorage&quot; == &quot;NO&quot; ]; then&#xD;&#xA;if [ &quot;$recoveryHD&quot; == &quot;NO&quot; ]; then &#xD;&#xA;echo `/bin/date` &quot;Boot Volume is not a CoreStorage Volume, and there is no Recovery HD, so FileVault cannot be enabled.&quot; &#xD;&#xA;/Library/Application\ Support/LANDesk/bin/ldnotify -m &quot;$deferFile がコア ストレージ ボリュームではなく、Recovery HD がないため、LANDESK ldms は、このデバイスのボリューム $deferFile に対してFileVault を有効にすることができません。&quot; -y &quot;OK&quot; -p &quot;FileVault が有効になっていません&quot; &#xD;&#xA;&#xD;&#xA;exit 1 &#xD;&#xA;fi &#xD;&#xA;fi&#xD;&#xA;deferFile=`diskutil info / | grep &quot;Volume Name:&quot; | cut -d ':' -f 2 | sed -e 's/^ *//' -e 's/ *$//'`&#xD;&#xA;if [ &quot;$atLeast10103&quot; == &quot;YES&quot; ]; then&#xD;&#xA;sudo fdesetup enable -defer &quot;/Library/Application Support/LANDesk/data/$deferFile-fv2recovery.plist&quot;  -dontaskatlogout -forceatlogin 0 &#xD;&#xA;else&#xD;&#xA;&#xD;&#xA;sudo fdesetup enable -defer &quot;/Library/Application Support/LANDesk/data/$deferFile-fv2recovery.plist&quot; &#xD;&#xA;fi&#xD;&#xA;if [ $?  -ne 0 ]; then &#xD;&#xA;echo `/bin/date` &quot;fdesetup enable -defer failed&quot; &#xD;&#xA;exit 1 &#xD;&#xA;else&#xD;&#xA; &#xD;&#xA;echo `/bin/date` &quot;setting up submit to core of the FileVauilt2RecoveryKey&quot;&#xD;&#xA;sudo /Library/Application\ Support/LANDesk/bin/ldsubmitclientdata -dataname=&quot;FileVauilt2RecoveryKey&quot; -d -retry=20 -datafile=&quot;/Library/Application Support/LANDesk/data/$deferFile-fv2recovery.plist&quot; &#xD;&#xA;/Library/Application\ Support/LANDesk/bin/ldnotify -m &quot;LANDESK ldms は、このデバイスのボリューム $deferFile に対して FileVault  を有効にしました。 このデバイスをできるだけ早く再起動して、処理を完了してください。&quot; -y &quot;OK&quot; -p &quot;FileVault  が有効になっています&quot; &#xD;&#xA;exit 0 &#xD;&#xA;fi " />
          </Args>
        </Cmd>
      </Cmds>
    </Patch>
  </Patches>
  <AssociatedProducts />
  <IAVAs />
  <PublishDate>2015-08-25T00:00:00.0000000</PublishDate>
  <Title>FileVault Activation version 1.1</Title>
  <Description>LDMS エージェントがインストールされた Mac OS X クライアント デバイスを管理するための基本検出および修正コンテンツ。

この処理で必要なデバイス制御は、コマンドライン ツール fdesetup で実行されます。fdesetup とそのオプションの詳細については、メイン ページを参照してください。使用方法の詳細については、インターネットを参照してください。Rich Trouton 氏のMac 管理ブログである derflounder には、より詳細な内容が記載されています。導入については、&lt;https://derflounder.wordpress.com/2015/02/02/managing-yosemites-filevault-2-with-fdesetup/&gt; をご覧ください。

検出:

bash スクリプトは、デバイスの FileVault のステータスを判定するために使用されます。

修正:

bash スクリプトを使用して Filevault を有効にし、LDMS ツールの ldsubmitclientdata を実行して、回復キーを安全に LANDESK サーバに送信します。LANDESK サーバではキーが安全な表に格納されます。表はインベントリとは独立しているため、デバイスがインベントリから削除されても、レコードは削除されません。 

fdesetup enable -defer が呼び出されます。このコンテンツで選択したオプションを使用すると、これにより、ユーザは次回のログイン時に処理を強制的に完了します。遅延オプションを使用すると、ユーザが実際に処理を完了しようとするまで、fdesetup は失敗しません。このため、スクリプトの能力が上がり、事前に最も一般的なエラー モードを検出します。

デバイスで FileVault を有効にするには、ブート ボリュームが CoreStorage ボリュームであるか、Recovery HD が存在している必要があります。このスクリプトは、これらの1つ以上が true であることを確認し、両方が false である場合には失敗します。

LANDESK ツール ldnotify を使用して、ユーザ情報を指定します。

ldsubmitclientdata パラメータはデータ名 (コア データベースの場合は変更不可)、データ ファイル (回復キー ファイルへの完全パス。fdesetup の -defer パラメータと一致している必要があります)、再試行、ldsubmitclientdata が回復キーをコア サーバへの送信を試行する回数です。コアに正常に送信されるまでは、回復キー ファイルは管理されたデバイスから削除されません。</Description>
  <Severity>5</Severity>
  <Vendor>Ivanti</Vendor>
  <MoreInfoURL />
  <FAQURL />
  <Type>Configuration</Type>
</Vulnerability>
